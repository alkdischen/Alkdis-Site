<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>BusTub å…»æˆè®°ï¼šä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“ - Alkdis Chen</title><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="BusTub å…»æˆè®°ï¼šä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“">
<meta itemprop="description" content="åœ¨ä»Šå¹´å…«æœˆä»½ä»¥å‰ï¼ŒBusTub (CMU 15-445/645 Database Systems çš„è¯¾ç¨‹é¡¹ç›®) åªæ¶µç›–äº†æ•°æ®åº“ç³»ç»Ÿåº•å±‚çš„éƒ¨åˆ†ï¼šå†…å­˜ç®¡ç† (Project 1 Buffer Pool Manager)ã€å­˜å‚¨å¼•æ“ (Project 2 Index)ã€æ‰§è¡Œå™¨ (Project 3 Query Execution)ï¼Œä»¥åŠå¹¶å‘æ§åˆ¶ (Project 4 Concurrency Control)ã€‚å…«æœˆä»½æˆ‘å¼€å§‹å†™ BusTub çš„ Query Processing Layerï¼Œå¼•å…¥äº†ä¸€æ•´å¥— SQL å±‚ï¼Œå®ç°äº† BusTub ä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“çš„é£è·ƒã€‚æœ¬å­¦æœŸå¼€å§‹ï¼Œå­¦ç”Ÿå°†å¯ä»¥ç›´æ¥ä½¿ç”¨ BusTub è·‘ SQL æŸ¥è¯¢ï¼ŒéªŒè¯è‡ªå·±å®ç°çš„ç®—å­æ˜¯å¦æ­£ç¡®ã€‚
BusTub çš„ SQL å±‚å’Œæœ¬å¤±è´¥äººå£«ä¹‹å‰å‚ä¸çš„ RisingLight / RisingWave é¡¹ç›®ä¸€è„‰ç›¸æ‰¿ï¼Œå’Œ DuckDB æ€è·¯ç±»ä¼¼ã€‚Parser ä½¿ç”¨ DuckDB æ‰“åŒ…çš„ libpg_queryã€‚SQL è¯­å¥ parse åï¼Œé€šè¿‡ binder ç»‘å®š identifier åˆ°å„ä¸ªå®ä½“ï¼Œä½¿ç”¨ planner ç”ŸæˆæŸ¥è¯¢è®¡åˆ’ï¼Œè€Œåä½¿ç”¨ optimizer ä¼˜åŒ–æˆæœ€ç»ˆçš„æŸ¥è¯¢è®¡åˆ’ã€‚BusTub çš„ æ•´ä¸ª SQL å¼•æ“ç›®å‰æ”¯æŒç®€å•çš„ join, aggregation æŸ¥è¯¢ï¼Œuncorrelated subquery, ä»¥åŠ CTEã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒBusTub ç°åœ¨è¿˜å¯ä»¥ç¼–è¯‘æˆ WASMï¼Œç›´æ¥åœ¨æµè§ˆå™¨é‡Œè·‘ã€‚æˆ‘ä»¬å°†ä¼šæŠŠ BusTub å‚è€ƒç­”æ¡ˆçš„ç¼–è¯‘äº§ç‰©é€šè¿‡ç½‘é¡µçš„å½¢å¼å‘æ”¾ç»™å­¦ç”Ÿï¼Œè¿™æ ·å­¦ç”Ÿåœ¨åšé¡¹ç›®ä¹‹å‰å°±å¯ä»¥å¤§æ¦‚äº†è§£ BusTub çš„æœ€ç»ˆå½¢æ€æ˜¯ä»€ä¹ˆæ ·çš„ã€‚"><meta itemprop="datePublished" content="2022-10-05T22:00:00-04:00" />
<meta itemprop="dateModified" content="2022-10-05T22:00:00-04:00" />
<meta itemprop="wordCount" content="802">
<meta itemprop="keywords" content="" /><meta property="og:title" content="BusTub å…»æˆè®°ï¼šä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“" />
<meta property="og:description" content="åœ¨ä»Šå¹´å…«æœˆä»½ä»¥å‰ï¼ŒBusTub (CMU 15-445/645 Database Systems çš„è¯¾ç¨‹é¡¹ç›®) åªæ¶µç›–äº†æ•°æ®åº“ç³»ç»Ÿåº•å±‚çš„éƒ¨åˆ†ï¼šå†…å­˜ç®¡ç† (Project 1 Buffer Pool Manager)ã€å­˜å‚¨å¼•æ“ (Project 2 Index)ã€æ‰§è¡Œå™¨ (Project 3 Query Execution)ï¼Œä»¥åŠå¹¶å‘æ§åˆ¶ (Project 4 Concurrency Control)ã€‚å…«æœˆä»½æˆ‘å¼€å§‹å†™ BusTub çš„ Query Processing Layerï¼Œå¼•å…¥äº†ä¸€æ•´å¥— SQL å±‚ï¼Œå®ç°äº† BusTub ä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“çš„é£è·ƒã€‚æœ¬å­¦æœŸå¼€å§‹ï¼Œå­¦ç”Ÿå°†å¯ä»¥ç›´æ¥ä½¿ç”¨ BusTub è·‘ SQL æŸ¥è¯¢ï¼ŒéªŒè¯è‡ªå·±å®ç°çš„ç®—å­æ˜¯å¦æ­£ç¡®ã€‚
BusTub çš„ SQL å±‚å’Œæœ¬å¤±è´¥äººå£«ä¹‹å‰å‚ä¸çš„ RisingLight / RisingWave é¡¹ç›®ä¸€è„‰ç›¸æ‰¿ï¼Œå’Œ DuckDB æ€è·¯ç±»ä¼¼ã€‚Parser ä½¿ç”¨ DuckDB æ‰“åŒ…çš„ libpg_queryã€‚SQL è¯­å¥ parse åï¼Œé€šè¿‡ binder ç»‘å®š identifier åˆ°å„ä¸ªå®ä½“ï¼Œä½¿ç”¨ planner ç”ŸæˆæŸ¥è¯¢è®¡åˆ’ï¼Œè€Œåä½¿ç”¨ optimizer ä¼˜åŒ–æˆæœ€ç»ˆçš„æŸ¥è¯¢è®¡åˆ’ã€‚BusTub çš„ æ•´ä¸ª SQL å¼•æ“ç›®å‰æ”¯æŒç®€å•çš„ join, aggregation æŸ¥è¯¢ï¼Œuncorrelated subquery, ä»¥åŠ CTEã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒBusTub ç°åœ¨è¿˜å¯ä»¥ç¼–è¯‘æˆ WASMï¼Œç›´æ¥åœ¨æµè§ˆå™¨é‡Œè·‘ã€‚æˆ‘ä»¬å°†ä¼šæŠŠ BusTub å‚è€ƒç­”æ¡ˆçš„ç¼–è¯‘äº§ç‰©é€šè¿‡ç½‘é¡µçš„å½¢å¼å‘æ”¾ç»™å­¦ç”Ÿï¼Œè¿™æ ·å­¦ç”Ÿåœ¨åšé¡¹ç›®ä¹‹å‰å°±å¯ä»¥å¤§æ¦‚äº†è§£ BusTub çš„æœ€ç»ˆå½¢æ€æ˜¯ä»€ä¹ˆæ ·çš„ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.alkdischen.cn/posts/articles/2022-10-05-bustub-query-processing/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-05T22:00:00-04:00" />
<meta property="article:modified_time" content="2022-10-05T22:00:00-04:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="BusTub å…»æˆè®°ï¼šä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“"/>
<meta name="twitter:description" content="åœ¨ä»Šå¹´å…«æœˆä»½ä»¥å‰ï¼ŒBusTub (CMU 15-445/645 Database Systems çš„è¯¾ç¨‹é¡¹ç›®) åªæ¶µç›–äº†æ•°æ®åº“ç³»ç»Ÿåº•å±‚çš„éƒ¨åˆ†ï¼šå†…å­˜ç®¡ç† (Project 1 Buffer Pool Manager)ã€å­˜å‚¨å¼•æ“ (Project 2 Index)ã€æ‰§è¡Œå™¨ (Project 3 Query Execution)ï¼Œä»¥åŠå¹¶å‘æ§åˆ¶ (Project 4 Concurrency Control)ã€‚å…«æœˆä»½æˆ‘å¼€å§‹å†™ BusTub çš„ Query Processing Layerï¼Œå¼•å…¥äº†ä¸€æ•´å¥— SQL å±‚ï¼Œå®ç°äº† BusTub ä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“çš„é£è·ƒã€‚æœ¬å­¦æœŸå¼€å§‹ï¼Œå­¦ç”Ÿå°†å¯ä»¥ç›´æ¥ä½¿ç”¨ BusTub è·‘ SQL æŸ¥è¯¢ï¼ŒéªŒè¯è‡ªå·±å®ç°çš„ç®—å­æ˜¯å¦æ­£ç¡®ã€‚
BusTub çš„ SQL å±‚å’Œæœ¬å¤±è´¥äººå£«ä¹‹å‰å‚ä¸çš„ RisingLight / RisingWave é¡¹ç›®ä¸€è„‰ç›¸æ‰¿ï¼Œå’Œ DuckDB æ€è·¯ç±»ä¼¼ã€‚Parser ä½¿ç”¨ DuckDB æ‰“åŒ…çš„ libpg_queryã€‚SQL è¯­å¥ parse åï¼Œé€šè¿‡ binder ç»‘å®š identifier åˆ°å„ä¸ªå®ä½“ï¼Œä½¿ç”¨ planner ç”ŸæˆæŸ¥è¯¢è®¡åˆ’ï¼Œè€Œåä½¿ç”¨ optimizer ä¼˜åŒ–æˆæœ€ç»ˆçš„æŸ¥è¯¢è®¡åˆ’ã€‚BusTub çš„ æ•´ä¸ª SQL å¼•æ“ç›®å‰æ”¯æŒç®€å•çš„ join, aggregation æŸ¥è¯¢ï¼Œuncorrelated subquery, ä»¥åŠ CTEã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒBusTub ç°åœ¨è¿˜å¯ä»¥ç¼–è¯‘æˆ WASMï¼Œç›´æ¥åœ¨æµè§ˆå™¨é‡Œè·‘ã€‚æˆ‘ä»¬å°†ä¼šæŠŠ BusTub å‚è€ƒç­”æ¡ˆçš„ç¼–è¯‘äº§ç‰©é€šè¿‡ç½‘é¡µçš„å½¢å¼å‘æ”¾ç»™å­¦ç”Ÿï¼Œè¿™æ ·å­¦ç”Ÿåœ¨åšé¡¹ç›®ä¹‹å‰å°±å¯ä»¥å¤§æ¦‚äº†è§£ BusTub çš„æœ€ç»ˆå½¢æ€æ˜¯ä»€ä¹ˆæ ·çš„ã€‚"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.alkdischen.cn/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.alkdischen.cn/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://www.alkdischen.cn/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://www.alkdischen.cn/js/main.js"></script>
	
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css" integrity="sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs" crossorigin="anonymous">

		
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js" integrity="sha384-ljao5I1l+8KYFXG7LNEA7DyaFvuvSCmedUf6Y6JI7LJqiu8q5dEivP2nDdFH31V4" crossorigin="anonymous"></script>

		
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
			onload="renderMathInElement(document.body, { delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}], throwOnError : false });"></script>
	
</head>



<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://www.alkdischen.cn/">
				<img src="https://picgo-1313480473.cos.ap-shanghai.myqcloud.com/Blog/sculpture.jpg" alt="Alkdis Chen" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://www.alkdischen.cn/">Alkdis Chen</a></h1>
	<div class="site-description"><p>Coding with wind</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/ikoltech" title="GitHub"><i data-feather="github"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">æ¨æ–‡</a>
			</li>
			
			<li>
				<a href="/posts-ng">Posts</a>
			</li>
			
			<li>
				<a href="/pages/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					
						<div class="meta">
							<div class="date">
								<span class="day">05</span>
								<span class="rest">Oct 2022</span>
							</div>
						</div>
					
				
				<div class="matter">
					<h1 class="title">BusTub å…»æˆè®°ï¼šä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“</h1>
					
				</div>
			</div>
					
			<div>
				
					<nav id="TableOfContents">
  <ul>
    <li><a href="#binder">Binder</a></li>
    <li><a href="#planner">Planner</a></li>
    <li><a href="#optimizer">Optimizer</a></li>
    <li><a href="#æ‰§è¡Œå™¨">æ‰§è¡Œå™¨</a></li>
    <li><a href="#åè®°">åè®°</a></li>
  </ul>
</nav>
					<hr>
				
			</div>
			<div class="markdown">
				<p>åœ¨ä»Šå¹´å…«æœˆä»½ä»¥å‰ï¼Œ<a href="https://github.com/cmu-db/bustub">BusTub (CMU 15-445/645 Database Systems çš„è¯¾ç¨‹é¡¹ç›®)</a> åªæ¶µç›–äº†æ•°æ®åº“ç³»ç»Ÿåº•å±‚çš„éƒ¨åˆ†ï¼šå†…å­˜ç®¡ç† (Project 1 Buffer Pool Manager)ã€å­˜å‚¨å¼•æ“ (Project 2 Index)ã€æ‰§è¡Œå™¨ (Project 3 Query Execution)ï¼Œä»¥åŠå¹¶å‘æ§åˆ¶ (Project 4 Concurrency Control)ã€‚å…«æœˆä»½æˆ‘å¼€å§‹å†™ BusTub çš„ Query Processing Layerï¼Œå¼•å…¥äº†ä¸€æ•´å¥— SQL å±‚ï¼Œå®ç°äº† BusTub ä»è¯¾ç¨‹é¡¹ç›®åˆ° SQL æ•°æ®åº“çš„é£è·ƒã€‚æœ¬å­¦æœŸå¼€å§‹ï¼Œå­¦ç”Ÿå°†å¯ä»¥ç›´æ¥ä½¿ç”¨ BusTub è·‘ SQL æŸ¥è¯¢ï¼ŒéªŒè¯è‡ªå·±å®ç°çš„ç®—å­æ˜¯å¦æ­£ç¡®ã€‚</p>
<p><img src="overview.png" alt="BusTub Overview"></p>
<p>BusTub çš„ SQL å±‚å’Œæœ¬å¤±è´¥äººå£«ä¹‹å‰å‚ä¸çš„ RisingLight / RisingWave é¡¹ç›®ä¸€è„‰ç›¸æ‰¿ï¼Œå’Œ DuckDB æ€è·¯ç±»ä¼¼ã€‚Parser ä½¿ç”¨ DuckDB æ‰“åŒ…çš„ libpg_queryã€‚SQL è¯­å¥ parse åï¼Œé€šè¿‡ binder ç»‘å®š identifier åˆ°å„ä¸ªå®ä½“ï¼Œä½¿ç”¨ planner ç”ŸæˆæŸ¥è¯¢è®¡åˆ’ï¼Œè€Œåä½¿ç”¨ optimizer ä¼˜åŒ–æˆæœ€ç»ˆçš„æŸ¥è¯¢è®¡åˆ’ã€‚BusTub çš„ æ•´ä¸ª SQL å¼•æ“ç›®å‰æ”¯æŒç®€å•çš„ join, aggregation æŸ¥è¯¢ï¼Œuncorrelated subquery, ä»¥åŠ CTEã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒBusTub ç°åœ¨è¿˜å¯ä»¥ç¼–è¯‘æˆ WASMï¼Œç›´æ¥åœ¨æµè§ˆå™¨é‡Œè·‘ã€‚æˆ‘ä»¬å°†ä¼šæŠŠ BusTub å‚è€ƒç­”æ¡ˆçš„ç¼–è¯‘äº§ç‰©é€šè¿‡ç½‘é¡µçš„å½¢å¼å‘æ”¾ç»™å­¦ç”Ÿï¼Œè¿™æ ·å­¦ç”Ÿåœ¨åšé¡¹ç›®ä¹‹å‰å°±å¯ä»¥å¤§æ¦‚äº†è§£ BusTub çš„æœ€ç»ˆå½¢æ€æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<p>ä»è¯¾ç¨‹è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼ŒBusTub çš„ Query Processing Layer ä»£ç ç›´æ¥æ”¾åœ¨äº† starter code é‡Œï¼Œå¹¶ä¸”é™„å¸¦äº†ä¸€äº›åŸºæœ¬çš„ç®—å­ã€‚å­¦ç”Ÿåœ¨å­¦æœŸåˆå°±å¯ä»¥ç›´æ¥è·‘ä¸€äº›éå¸¸ç®€å•çš„ query (æ‰«æ mock table, è¿‡æ»¤, åšç®€å•çš„æ•°å­¦è¿ç®—)ï¼›åœ¨å†™å®Œ Buffer Pool Manager ä¹‹åå°±å¯ä»¥å»ºè¡¨ï¼›å†™å®Œ Index åå¯ä»¥å»ºç´¢å¼•ï¼›å†™å®Œ Query Execution ä¹‹åï¼Œå°±åŸºæœ¬å¯ä»¥è·‘å¸¸è§çš„ SQL query äº†ã€‚</p>
<p>è™½ç„¶ BusTub Query Processing Layer çš„ä»£ç å·²ç»æ²¡æœ‰å¤ªå¤šå¯ä»¥æ”¹çš„åœ°æ–¹äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿç»™å­¦ç”Ÿä¿ç•™äº†ä¸€äº›è‡ªç”±å‘æŒ¥çš„ç©ºé—´ã€‚å­¦ç”Ÿå¯ä»¥å®ç°æ–°çš„ optimizer è§„åˆ™ï¼Œé€šè¿‡ç®€å•çš„å˜åŒ–è®© query å¯ä»¥æ›´å¿«æ‰§è¡Œï¼Œè¿™æ˜¯ query execution project çš„æ‹“å±•ä»»åŠ¡ï¼›ä¸æ­¤åŒæ—¶ä¹Ÿå¯ä»¥å®ç°æ–°çš„è¡¨è¾¾å¼ï¼Œè¿™å°†ä¼šæ˜¯æœªæ¥çš„ project 0 C++ primerã€‚</p>
<p>æœ¬æ–‡ä¸»è¦æ˜¯ç»éªŒä¹‹è°ˆï¼Œæ‰€ä»¥å¤§å¤šæ•°å†…å®¹éƒ½æ˜¯æµæ°´è´¦ï¼Œæ¯”è¾ƒæ¯ç‡¥ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¹²è´§ã€‚è¿™ç¯‡æ–‡ç« å¯ä»¥çœ‹ä½œä¸€ç¯‡è¸©å‘æ–‡ç« ã€‚æœ¬æ¥ DB ç•Œå°±æ²¡ä»€ä¹ˆäººä¼šä»å¤´å†™ binder, planner, optimizerã€‚å¦‚æœæœ‰äººçœŸæœ‰æœºä¼šå†™ï¼Œä¹Ÿå¯ä»¥åˆ°é‚£æ—¶å›å¿†ä¸€ä¸‹è¿Ÿå…ˆç”Ÿæ›¾ç»è¸©è¿‡çš„å‘ï¼Œçœ‹çœ‹è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç» BusTub SQL å¼•æ“çš„å„ä¸ªæ¨¡å—ã€‚Parser å°±æ˜¯ libpg_queryï¼Œæ‰€ä»¥æ²¡æœ‰å¤ªå¤šå¯ä»¥è¯¦ç»†è®²çš„åœ°æ–¹ï¼Œæˆ‘ä»¬è·³è¿‡è¿™ä¸ªéƒ¨åˆ†ã€‚</p>
<h2 id="binder">Binder</h2>
<p>é€šè¿‡ libpg_query äº§ç”Ÿ Postgres AST åï¼ŒBinder å°†ä¼šæŠŠè¿™ä¸ª AST æ”¹å†™æˆ BusTub å¯ä»¥ç†è§£çš„ä¸€ä¸ªæ›´é«˜çº§çš„ ASTã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰ identifier è§£ææˆæ²¡æœ‰æ­§ä¹‰çš„å®ä½“ã€‚æˆ‘ä»¬ä»¥æœ€ç®€å•çš„ <code>select *</code> ä¸ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>bustub&gt; explain (binder) select * from __mock_table_1;
</span></span><span style="display:flex;"><span>=== BINDER ===
</span></span><span style="display:flex;"><span>BoundSelect {
</span></span><span style="display:flex;"><span>  table=BoundBaseTableRef { table=__mock_table_1, oid=0 },
</span></span><span style="display:flex;"><span>  columns=[__mock_table_1.colA, __mock_table_1.colB],
</span></span><span style="display:flex;"><span>  groupBy=[],
</span></span><span style="display:flex;"><span>  having=,
</span></span><span style="display:flex;"><span>  where=,
</span></span><span style="display:flex;"><span>  limit=,
</span></span><span style="display:flex;"><span>  offset=,
</span></span><span style="display:flex;"><span>  order_by=[],
</span></span><span style="display:flex;"><span>  is_distinct=false,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Binder ä¼šåœ¨ catalog é‡Œé¢æŸ¥ <code>__mock_table_1</code> çš„ä¿¡æ¯ï¼Œå°† <code>__mock_table_1</code> ç»‘å®šåˆ°å…·ä½“çš„å®ä½“è¡¨ä¸Š (<code>table_oid=0</code>)ã€‚ä¸æ­¤åŒæ—¶ï¼Œå°† <code>select *</code> ä¸­çš„ <code>*</code> å±•å¼€æˆå¯ä»¥æŸ¥åˆ°çš„æ‰€æœ‰åˆ—ã€‚è¿™å°±å®Œæˆäº†æ•´ä¸ª binding çš„è¿‡ç¨‹ã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªå¤æ‚çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>bustub&gt; explain (binder) select colC from (select * from __mock_table_2, __mock_table_3);
</span></span><span style="display:flex;"><span>=== BINDER ===
</span></span><span style="display:flex;"><span>BoundSelect {
</span></span><span style="display:flex;"><span>  table=BoundSubqueryRef {
</span></span><span style="display:flex;"><span>    alias=__subquery#0,
</span></span><span style="display:flex;"><span>    subquery=BoundSelect {
</span></span><span style="display:flex;"><span>      table=BoundCrossProductRef { left=BoundBaseTableRef { table=__mock_table_2, oid=1 }, right=BoundBaseTableRef { table=__mock_table_3, oid=2 } },
</span></span><span style="display:flex;"><span>      columns=[__mock_table_2.colC, __mock_table_2.colD, __mock_table_3.colE, __mock_table_3.colF],
</span></span><span style="display:flex;"><span>      groupBy=[],
</span></span><span style="display:flex;"><span>      having=,
</span></span><span style="display:flex;"><span>      where=,
</span></span><span style="display:flex;"><span>      limit=,
</span></span><span style="display:flex;"><span>      offset=,
</span></span><span style="display:flex;"><span>      order_by=[],
</span></span><span style="display:flex;"><span>      is_distinct=false,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    columns=[&#34;__mock_table_2.colC&#34;, &#34;__mock_table_2.colD&#34;, &#34;__mock_table_3.colE&#34;, &#34;__mock_table_3.colF&#34;],
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  columns=[__subquery#0.__mock_table_2.colC],
</span></span><span style="display:flex;"><span>  groupBy=[],
</span></span><span style="display:flex;"><span>  having=,
</span></span><span style="display:flex;"><span>  where=,
</span></span><span style="display:flex;"><span>  limit=,
</span></span><span style="display:flex;"><span>  offset=,
</span></span><span style="display:flex;"><span>  order_by=[],
</span></span><span style="display:flex;"><span>  is_distinct=false,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>from</code> å­å¥é‡Œé¢çš„ cross join è¢«ç»‘å®šåˆ°äº† <code>BoundCrossProductRef</code> ä¸Šï¼Œé‡Œé¢åŒ…å«ä¸¤ä¸ªè¡¨ã€‚subquery ä¸­çš„ <code>*</code> è¢«å±•å¼€æˆäº†å®Œæ•´çš„åˆ—å <code>__mock_table_2.colC, __mock_table_2.colD, __mock_table_3.colE, __mock_table_3.colF</code>ã€‚æœ€å¤–å±‚çš„ <code>colC</code> è¢«è§£ææˆäº† <code>__subquery#0.__mock_table_2.colC</code>ã€‚æ•´ä¸ªè¿‡ç¨‹ç»“æŸåï¼Œäº§ç”Ÿäº†ä¸€ä¸ªæ²¡æœ‰æ­§ä¹‰çš„ BusTub ASTã€‚è¿™å°±æ˜¯ binder åšçš„äº‹æƒ…ã€‚</p>
<p>åˆšåˆšçš„è®¨è®ºéƒ½æ˜¯åŸºäº from é‡Œé¢åªæœ‰ table çš„å‰æè®¨è®ºçš„ã€‚è¡¨è¾¾å¼çš„ç»‘å®šåœ¨ from ç»‘å®šå®Œè¿›è¡Œã€‚å› æ­¤è¡¨è¾¾å¼æ€»å¯ä»¥åœ¨å¯¹åº”çš„ table é‡Œæ‰¾åˆ°åˆ—ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç¨å¾®å¤æ‚çš„ç‰¹ä¾‹ï¼Œéœ€è¦åœ¨ from ç»‘å®šåˆ°ä¸€åŠçš„è¿‡ç¨‹ä¸­åšä¸€äº›è¡¨è¾¾å¼çš„è§£æã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>explain select * from (
</span></span><span style="display:flex;"><span>	a inner join b on a.cola = b.cola
</span></span><span style="display:flex;"><span>	) inner join c on a.cola = c.cola;
</span></span></code></pre></div><p>åœ¨ç»‘å®š <code>a inner join b on a.cola = b.cola</code> çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å°† <code>a.cola</code> å’Œ <code>b.colb</code> å¯¹åº”åˆ°å…·ä½“çš„å®ä½“ä¸Šã€‚å› æ­¤æˆ‘ä»¬å…ˆå°† <code>a inner join b</code> ç»‘å®šæˆä¸€ä¸ªæ²¡æœ‰ join æ¡ä»¶çš„ <code>BoundJoinRef</code>ï¼Œè€Œåç”¨è¿™ä¸ªæ²¡æœ‰æ¡ä»¶çš„ <code>BoundJoinRef</code> ä½œä¸º scope ç»‘å®šè¡¨è¾¾å¼ï¼Œæœ€åæŠŠè¡¨è¾¾å¼æ”¾å› <code>BoundJoinRef</code> ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ç¨å¾®æœ‰ç‚¹ hackï¼Œä½†æ•´ä½“æ¥çœ‹ä¹Ÿæ¯”è¾ƒå¹²å‡€ã€‚</p>
<p>å¦å¤–æœ‰ä¸€äº›å¾ˆå¤šæ•°æ®åº“éƒ½æ”¯æŒçš„ç¥å¥‡å†™æ³•ï¼Œåœ¨ BusTub é‡Œé¢ç”±äºå®ç°ä¸å¤ªå¹²å‡€è€Œæ²¡æœ‰æ”¯æŒã€‚æ¯”å¦‚è¿™ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>explain select max(x) as max_x from table group by c having max_x &gt; 10
</span></span></code></pre></div><p><code>max_x</code> æ˜¯ä¸€ä¸ª select åˆ—è¡¨é‡Œé¢çš„ aliasã€‚åœ¨ binder é‡Œé¢ï¼Œæˆ‘ä»¬å°† select çœ‹ä½œä¸€ä¸ªæ•´ä½“æ¥åšç»‘å®šï¼Œåœ¨ç»‘å®šè¿™æ¡è¯­å¥çš„æ—¶å€™ï¼Œidentifier ç»‘å®šçš„èŒƒå›´ä»…ä»…æ˜¯ from å­å¥ä¸­çš„è¡¨ã€‚å› æ­¤ï¼Œç»‘å®š having å­å¥çš„è¿‡ç¨‹ä¸­æ²¡æœ‰åŠæ³•æ‰¾åˆ° <code>max_x</code> è¿™ä¸ª identifierã€‚å› æ­¤è¿™æ¡ query åœ¨ BusTub é‡Œé¢åªèƒ½è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>explain select max(x) as max_x from table group by c having max(x) &gt; 10
</span></span></code></pre></div><p>åæ¥æˆ‘æŸ¥äº†ä¸€ä¸‹ SQL æ ‡å‡†ï¼Œæ ‡å‡†ä¹Ÿæ²¡æœ‰è¯´æ”¯æŒåœ¨ having å­å¥é‡Œç”¨ alias ğŸ¤£ã€‚</p>
<h2 id="planner">Planner</h2>
<p>Planner é€’å½’éå† Binder äº§ç”Ÿçš„ BusTub ASTï¼Œäº§ç”Ÿä¸€ä¸ªåˆæ­¥çš„æŸ¥è¯¢è®¡åˆ’ã€‚å¸æ”¶äº†ä¹‹å‰é¡¹ç›®é‡Œè¸©è¿‡çš„å‘ï¼Œå¹¶ä¸”ä¸ºäº†æ–¹ä¾¿å®ç°ã€æ˜“äºç†è§£ï¼ŒBusTub æœ‰è¿™ä¹ˆå‡ ä¸ªè®¾è®¡ç‚¹ï¼š</p>
<ul>
<li>åœ¨ planner å’Œ binder ä¸­ä½¿ç”¨ä¸¤å¥—è¡¨è¾¾å¼è¡¨ç¤ºã€‚ä¸¤è€…è¡¨è¾¾å¼è¡¨ç¤ºçš„æœ€å¤§åŒºåˆ«æ˜¯åœ¨å¼•ç”¨åˆ—çš„æ–¹å¼ä¸Šã€‚Binder ä¸­çš„è¡¨è¾¾å¼å¦‚æœéœ€è¦ç”¨ä¸€åˆ—ï¼Œå¿…é¡»ä½¿ç”¨å®Œæ•´çš„åˆ—åã€‚æ¯”å¦‚ <code>__subquery#0.__mock_table_2.colC</code>ã€‚Planner ä¸­çš„è¡¨è¾¾å¼åªèƒ½ä½¿ç”¨åˆ—çš„ä½ç½®ï¼Œæ¯”å¦‚ <code>#0.1</code>ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 0 ä¸ªå­©å­çš„ç¬¬ 1 åˆ—ã€‚RisingLight é‡Œé¢æœ€å¤´å¤§çš„ä¸€ç‚¹å°±æ˜¯æŠŠè¿™ä¸¤ç§è¡¨ç¤ºæ··åœ¨äº†ä¸€èµ·ï¼Œå¯¼è‡´ planning æ—¶çš„ä»£ç å®¹æ˜“å‡ºé”™ã€‚BusTub çš„è®¾è®¡å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</li>
<li>ä¸åˆ† logical plan node å’Œ physical plan nodeã€‚BusTub çš„ SQL å±‚é‡Œé¢æœ‰ planner å’Œ optimizerã€‚é€šå¸¸åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œplanner ç”Ÿæˆ logical plan nodeï¼Œç„¶åé€šè¿‡ optimizer æ¡†æ¶åšå¾ˆå¤šæ­¥ä¼˜åŒ–äº§ç”Ÿ physical plan nodeã€‚ä½†æ˜¯ BusTub åªæ˜¯ä¸ªæ•™å­¦é¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæœ‰ physical plan nodeã€‚Planner ä¼šç›´æ¥æŠŠ join plan æˆ NestedLoopJoinï¼Œåœ¨ optimizer é‡Œé¢æ”¹å†™æˆ HashJoin æˆ–è€… NestedIndexJoinã€‚</li>
<li>ç›¸è¾ƒäºä¸€å¹´å‰çš„ BusTubï¼Œå¼•å…¥ filter, projection, values plan nodeã€‚ç›¸å¯¹åº”çš„ï¼Œåœ¨æ‰§è¡Œå™¨ä¸­ç§»é™¤äº†å„ç§â€œé¡ºå¸¦åš filterâ€ã€â€œé¡ºå¸¦åš projectionâ€çš„éƒ¨åˆ†ã€‚è¿™äº›éƒ½ç‹¬ç«‹æˆäº†å•ç‹¬çš„ç®—å­ã€‚values plan node ç”¨äº <code>insert into values ...</code> è¯­å¥ã€‚</li>
</ul>
<p>ç›®å‰ Planner é‡Œé¢æœ€ä¸ºå¤æ‚çš„éƒ¨åˆ†å°±æ˜¯ aggregation ç®—å­çš„ planningã€‚é¦–å…ˆæˆ‘ä»¬è§„å®š aggregation ç®—å­åªåš aggregateï¼Œä¸å¤„ç† having å­å¥ã€aggregation å projectionã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>select x, max(y) + min(z) from t1 group by x having max(y) &gt; 10;
</span></span></code></pre></div><p>æ›¾ç»çš„ BusTub å¯ä»¥ç”¨ä¸€ä¸ª aggregation ç®—å­å¤„ç†è¿™ä¸€æ•´æ¡ queryã€‚åœ¨æ–°çš„ SQL layer çš„è®¾è®¡ä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©æŠŠå®ƒæ‹†å¼€ï¼Œè®©ä¸€ä¸ªç®—å­åªè´Ÿè´£ä¸€ä»¶äº‹æƒ…ã€‚ç°åœ¨ï¼Œè¿™æ¡ query ä¼šåœ¨ planner é˜¶æ®µç”Ÿæˆè¿™æ ·çš„æ‰§è¡Œè®¡åˆ’ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>bustub&gt; explain (p) select x, max(y) + min(z) from t1 group by x having max(y) &gt; 10;
</span></span><span style="display:flex;"><span>=== PLANNER ===
</span></span><span style="display:flex;"><span>Projection { exprs=[#0.0, #0.2+#0.3] }
</span></span><span style="display:flex;"><span>  Filter { predicate=#0.1&gt;10 }
</span></span><span style="display:flex;"><span>    Agg { types=[max, max, min], aggregates=[#0.1, #0.1, #0.2], group_by=[#0.0] }
</span></span><span style="display:flex;"><span>      SeqScan { table=t1 }
</span></span></code></pre></div><p>ä¸€ä¸ªç®€å•çš„ aggregation è¢«åˆ†æˆäº†ä¸‰ä¸ªç®—å­ï¼š</p>
<ul>
<li>Aggregation ç®—å­è®¡ç®— <code>max(y) (in having), max(y), min(z)</code>ã€‚</li>
<li>Filter ç®—å­å¤„ç† having å­å¥ã€‚</li>
<li>Projection ç®—å­åš <code>max(y) + min(z)</code>ã€‚</li>
</ul>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªç®—å­çš„èŒè´£å°±å˜å¾—ç›¸å½“æ¸…æ™°ã€‚ä½†æ˜¯è¿™ä¸ª planning çš„è¿‡ç¨‹å…·ä½“æ˜¯æ€ä¹ˆåšçš„ï¼Ÿåœ¨ planner çœ‹åˆ° <code>max(y) + min(z)</code> è¿™ä¸ªè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå®ƒç¬¬ä¸€çœ¼åªèƒ½çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ª binary operation <code>+</code>ã€‚åªæœ‰æ·±å…¥ä¸€å±‚çœ‹çœ‹å·¦æ‰‹è¾¹æ˜¯å•¥ã€å³æ‰‹è¾¹æ˜¯å•¥ï¼Œæ‰èƒ½æ˜ç™½è¿™ä¸ªåŠ æ³•ä¸æ˜¯ä¸€ä¸ªç®€å•çš„åŠ æ³•ï¼Œè€Œæ˜¯è¦åœ¨ aggregation ä¹‹åæ‰èƒ½åŠ ã€‚</p>
<p>è¿™å°±æ˜¯ plan è¡¨è¾¾å¼çš„æ—¶å€™æ¯”è¾ƒ tricky çš„åœ°æ–¹ã€‚Planner ä¸­æœ‰ä¸€ä¸ª Contextï¼Œç”¨äºè¡¨ç¤ºå½“å‰æ˜¯å¦åœ¨ plan aggregation ç®—å­ã€‚å¦‚æœæ˜¯ï¼Œplan è¡¨è¾¾å¼æ—¶ç¢°åˆ°èšåˆå‡½æ•°ï¼Œå°±ä¼šå°†å®ƒæ›¿æ¢æˆä¸€ä¸ªå…·ä½“çš„åˆ— (æ¯”å¦‚ <code>#0.x</code>)ï¼Œç„¶åå°†èšåˆå‡½æ•°åŠ å…¥ Context çš„å¾…èšåˆåˆ—è¡¨ä¸­ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚ç°åœ¨å‡è®¾æˆ‘ä»¬åœ¨ plan selectï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼Œplan having å­å¥ã€‚é¦–å…ˆçœ‹åˆ°æ˜¯ <code>&gt;</code> binary operationï¼Œè€Œåçœ‹å·¦æ‰‹è¾¹æ˜¯ä¸€ä¸ª max function callã€‚äºæ˜¯æˆ‘ä»¬å°† <code>max(y)</code> åŠ å…¥ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶å°†è¿™ä¸ªä½ç½®çš„è¡¨è¾¾å¼æ›¿æ¢æˆ <code>#0.1</code> (ç¬¬ 0 åˆ—æ˜¯ group by)ã€‚å¤§äºå·å³æ‰‹è¾¹æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å¸¸é‡ã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼Œplan select listã€‚x æ˜¯ group columnï¼Œæ”¹å†™æˆ <code>#0.0</code>ã€‚<code>max(y) + min(z)</code> æ˜¯ä¸€ä¸ª binary operationã€‚çœ‹çœ‹åŠ å·å·¦æ‰‹è¾¹ <code>max(y)</code> æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼ŒåŠ åˆ°åˆ—è¡¨ä¸­ï¼Œå¹¶å°†è¿™ä¸ªä½ç½®çš„è¡¨è¾¾å¼æ›¿æ¢æˆ <code>#0.2</code>ã€‚åŠ å·å³æ‰‹è¾¹ <code>min(z)</code> åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œæ›¿æ¢æˆ <code>#0.3</code>ã€‚</li>
</ul>
<p>è¿™ä¸ªæµç¨‹å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å¾…èšåˆçš„åˆ—è¡¨å’Œæ”¹å†™åçš„ select list / having å­å¥å®Œæˆæ•´ä¸ª aggregation çš„ planning äº†ã€‚</p>
<h2 id="optimizer">Optimizer</h2>
<p>åˆšå¼€å§‹æˆ‘å¹¶ä¸æ‰“ç®—ç»™ BusTub åŠ ä¸Š optimizerï¼Œå¸Œæœ›åœ¨ planner é˜¶æ®µç›´æ¥åšå®Œæ‰€æœ‰äº‹æƒ…ã€‚ä½†åæ¥ä¸€æƒ³ï¼ŒåŠ ä¸Š optimizer å¯ä»¥è®©ä¸€äº›äº‹æƒ…å˜å¾—ç®€å•ï¼Œä¹Ÿå¯ä»¥è®©å­¦ç”Ÿæœ‰æ›´å¤šå¯ä»¥å‘æŒ¥çš„ç©ºé—´ï¼Œå› æ­¤è¿˜æ˜¯åŠ ä¸Šäº†ã€‚</p>
<p>BusTub optimizer æ˜¯ä¸€ä¸ª rule-based ä¼˜åŒ–å™¨ã€‚æˆ‘ä»¬å°†ä¸åŒçš„ rule æŒ‰é¡ºåºåº”ç”¨åˆ°å½“å‰çš„æ‰§è¡Œè®¡åˆ’ä¸Šï¼Œäº§ç”Ÿæœ€ç»ˆçš„æ‰§è¡Œè®¡åˆ’ã€‚æ¯ä¸€æ¡ rule ç”±å¼€å‘è€…æ‰‹åŠ¨å®ç°ï¼Œæˆ‘ä»¬å¹¶ä¸æä¾›ä¸€ä¸ªé€šç”¨çš„æ”¹å†™æ¡†æ¶ã€‚ç›®å‰å¤§éƒ¨åˆ† rule å®ç°çš„æ–¹å¼éƒ½æ˜¯ bottom-upï¼Œè‡ªä¸‹è€Œä¸Šæ”¹å†™æ•´ä¸ª query planã€‚</p>
<p>åœ¨ starter code ä¸­ï¼Œoptimizer æä¾›ä»¥ä¸‹å‡ ä¸ªåŸºæœ¬åŠŸèƒ½ï¼š</p>
<ul>
<li>å°† filter condition åˆå¹¶åˆ° NestedLoopJoin é‡Œã€‚æ¯”å¦‚ cross join <code>select * from a, b where a.x = b.y</code>ï¼Œåœ¨ planner é˜¶æ®µä¼šäº§ç”Ÿä¸€ä¸ª predicate ä¸º true çš„ NLJ å’Œä¸€ä¸ª <code>a.x = b.y</code> çš„ filterã€‚åœ¨ä¼˜åŒ–å™¨ä¸­æˆ‘ä»¬ä¼šæŠŠ filter åˆå¹¶åˆ° NLJ é‡Œé¢ã€‚</li>
<li>å¦‚æœæœ‰ä¸€ä¸ªç­‰å€¼æ¡ä»¶ï¼Œä¸”å³è¡¨ç­‰å€¼æ¡ä»¶çš„åˆ—å»ºäº†ç´¢å¼•ï¼Œå°±ç›´æ¥ä¼˜åŒ–æˆ NestedIndexJoinã€‚</li>
<li>å¦‚æœæœ‰ä¸€ä¸ªç­‰å€¼æ¡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰ç´¢å¼•ï¼Œå°±ä¼˜åŒ–æˆ HashJoinã€‚</li>
</ul>
<p>æˆ‘ç»å°½è„‘æ±æƒ³äº†ä¸‰ä¸ª leaderboard test SQLï¼Œæ¶µç›–äº†æˆ‘èƒ½æƒ³åˆ°çš„å¸¸è§çš„ä¼˜åŒ– (join reordering, predicate push-down, column pruning)ã€‚å­¦ç”Ÿå¯ä»¥å‘æŒ¥æƒ³è±¡åŠ›åœ¨ optimizer é‡Œé¢æ”¹å†™è¿™ä¸‰æ¡ SQLï¼Œä»è€Œè¾¾åˆ°æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<h2 id="æ‰§è¡Œå™¨">æ‰§è¡Œå™¨</h2>
<p>ç”±äºåŠ å…¥äº† Projection å’Œ Filter ç®—å­ï¼Œæ‰§è¡Œå™¨éƒ¨åˆ†ä¹Ÿè¿›è¡Œäº†ä¸å°‘çš„ä¿®æ”¹ã€‚å¤§éƒ¨åˆ†æ‰§è¡Œå™¨çš„ predicate å±æ€§è¢«ç§»é™¤äº†ã€‚æ¯”å¦‚ TableScan ä¸Šé¢ç°åœ¨å°±æ²¡æœ‰ predicate äº†ã€‚</p>
<p>ä¸æ­¤åŒæ—¶å»æ‰äº† DistinctExecutorï¼Œæ”¹ä¸ºç”± planner ç”Ÿæˆ group aggregationã€‚</p>
<p>ç”±äºåœ¨ planner é‡Œé¢ï¼Œaggregation çš„ having ç”± filter å¤„ç†ï¼Œèšåˆåçš„è¿ç®—ç”± projection å¤„ç†ï¼Œå› æ­¤ aggregation éœ€è¦åšçš„æ“ä½œä¹Ÿå˜å¾—ç®€å•äº†ã€‚</p>
<p>æ›¾ç» BusTub æœ€å¥‡æ€ªçš„åœ°æ–¹æ˜¯ schema é‡Œé¢å¯¹æ¯ä¸€åˆ—éƒ½ä¿å­˜äº†ä¸€ä¸ªè¡¨è¾¾å¼ã€‚è¿™ä¸ªå·²ç»è¢«å»æ‰äº†ã€‚ç°åœ¨ Schema å°±æ˜¯æè¿°ç®—å­è¾“å‡ºæ¯ä¸€åˆ—çš„ç±»å‹ï¼Œä¸å†è¦æ±‚æ²¡ä¸ªç®—å­ç®—å®Œä»¥åé¡ºä¾¿åš projectionã€‚</p>
<p>æ‰§è¡Œå™¨è¿˜åŠ å…¥äº† Sort, TopN executorï¼Œè¿™æ˜¯é¡¹ç›®å¼€å‘ä»¥æ¥ç¬¬ä¸€ä¸ªåšæ’åºçš„æ‰§è¡Œå™¨ã€‚</p>
<h2 id="åè®°">åè®°</h2>
<p>æ­£å½“æˆ‘åšç€æŠŠè¿™ä¸€å¥— query processing layer ç§»æ¤å› RisingLight çš„ç¾æ¢¦æ—¶ï¼ŒRunji éº»éº»ç»™ <a href="https://github.com/risinglightdb/risinglight/pull/702">RisingLight å‘äº†ä¸€ä¸ª Cascade optimizer çš„ Pull Request</a>ã€‚ç­‰åˆ°ä¸‹æ¬¡å†™ RusTub çš„æ—¶å€™å°±ä¸èƒ½ç”¨ä¸€å¥—ä»£ç äº† ğŸ˜­ğŸ˜­ğŸ˜­ã€‚</p>
<p>æ¬¢è¿åœ¨ <a href="https://github.com/skyzh/skyzh-site/issues/18">GitHub å¯¹åº”çš„ issue é‡Œ</a>å‚ä¸æœ¬æ–‡çš„è®¨è®ºã€‚</p>

				
			</div>

			<div class="tags">
				
					
				
			</div></div>
	</div>
	

<div class="footer wrapper">
	<nav class="nav">
		<div>2023  Â© Alkdis Chen |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a>  
    
    <div class="wrap">
    

        
    </div>

    
    
    
    
    </div>
	</nav>
</div>







  

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-52525161-8', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
